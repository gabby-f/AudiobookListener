{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ReadableWebToNodeStream = void 0;\nconst readable_stream_1 = require(\"readable-stream\");\n/**\n * Converts a Web-API stream into Node stream.Readable class\n * Node stream readable: https://nodejs.org/api/stream.html#stream_readable_streams\n * Web API readable-stream: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n * Node readable stream: https://nodejs.org/api/stream.html#stream_readable_streams\n */\nclass ReadableWebToNodeStream extends readable_stream_1.Readable {\n  /**\n   *\n   * @param stream ReadableStream: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n   */\n  constructor(stream) {\n    super();\n    this.bytesRead = 0;\n    this.released = false;\n    this.reader = stream.getReader();\n  }\n  /**\n   * Implementation of readable._read(size).\n   * When readable._read() is called, if data is available from the resource,\n   * the implementation should begin pushing that data into the read queue\n   * https://nodejs.org/api/stream.html#stream_readable_read_size_1\n   */\n  _read() {\n    // Should start pushing data into the queue\n    // Read data from the underlying Web-API-readable-stream\n    if (this.released) {\n      this.push(null); // Signal EOF\n      return;\n    }\n    this.pendingRead = this.reader.read().then(data => {\n      delete this.pendingRead;\n      if (data.done || this.released) {\n        this.push(null); // Signal EOF\n      } else {\n        this.bytesRead += data.value.length;\n        this.push(data.value); // Push new data to the queue\n      }\n    }).catch(err => {\n      this.destroy(err);\n    });\n  }\n  /**\n   * If there is no unresolved read call to Web-API Readable​Stream immediately returns;\n   * otherwise will wait until the read is resolved.\n   */\n  async waitForReadToComplete() {\n    if (this.pendingRead) {\n      await this.pendingRead;\n    }\n  }\n  /**\n   * Close wrapper\n   */\n  async close() {\n    await this.syncAndRelease();\n  }\n  async syncAndRelease() {\n    this.released = true;\n    await this.waitForReadToComplete();\n    await this.reader.releaseLock();\n  }\n}\nexports.ReadableWebToNodeStream = ReadableWebToNodeStream;","map":{"version":3,"names":["Object","defineProperty","exports","value","ReadableWebToNodeStream","readable_stream_1","require","Readable","constructor","stream","bytesRead","released","reader","getReader","_read","push","pendingRead","read","then","data","done","length","catch","err","destroy","waitForReadToComplete","close","syncAndRelease","releaseLock"],"sources":["C:/Users/gabby/Documents/Audiobook Listener/node_modules/readable-web-to-node-stream/lib/index.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ReadableWebToNodeStream = void 0;\nconst readable_stream_1 = require(\"readable-stream\");\n/**\n * Converts a Web-API stream into Node stream.Readable class\n * Node stream readable: https://nodejs.org/api/stream.html#stream_readable_streams\n * Web API readable-stream: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n * Node readable stream: https://nodejs.org/api/stream.html#stream_readable_streams\n */\nclass ReadableWebToNodeStream extends readable_stream_1.Readable {\n    /**\n     *\n     * @param stream ReadableStream: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n     */\n    constructor(stream) {\n        super();\n        this.bytesRead = 0;\n        this.released = false;\n        this.reader = stream.getReader();\n    }\n    /**\n     * Implementation of readable._read(size).\n     * When readable._read() is called, if data is available from the resource,\n     * the implementation should begin pushing that data into the read queue\n     * https://nodejs.org/api/stream.html#stream_readable_read_size_1\n     */\n    _read() {\n        // Should start pushing data into the queue\n        // Read data from the underlying Web-API-readable-stream\n        if (this.released) {\n            this.push(null); // Signal EOF\n            return;\n        }\n        this.pendingRead = this.reader\n            .read()\n            .then((data) => {\n            delete this.pendingRead;\n            if (data.done || this.released) {\n                this.push(null); // Signal EOF\n            }\n            else {\n                this.bytesRead += data.value.length;\n                this.push(data.value); // Push new data to the queue\n            }\n        })\n            .catch((err) => {\n            this.destroy(err);\n        });\n    }\n    /**\n     * If there is no unresolved read call to Web-API Readable​Stream immediately returns;\n     * otherwise will wait until the read is resolved.\n     */\n    async waitForReadToComplete() {\n        if (this.pendingRead) {\n            await this.pendingRead;\n        }\n    }\n    /**\n     * Close wrapper\n     */\n    async close() {\n        await this.syncAndRelease();\n    }\n    async syncAndRelease() {\n        this.released = true;\n        await this.waitForReadToComplete();\n        await this.reader.releaseLock();\n    }\n}\nexports.ReadableWebToNodeStream = ReadableWebToNodeStream;\n//# sourceMappingURL=index.js.map"],"mappings":"AAAA,YAAY;;AACZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,uBAAuB,GAAG,KAAK,CAAC;AACxC,MAAMC,iBAAiB,GAAGC,OAAO,CAAC,iBAAiB,CAAC;AACpD;AACA;AACA;AACA;AACA;AACA;AACA,MAAMF,uBAAuB,SAASC,iBAAiB,CAACE,QAAQ,CAAC;EAC7D;AACJ;AACA;AACA;EACIC,WAAWA,CAACC,MAAM,EAAE;IAChB,KAAK,CAAC,CAAC;IACP,IAAI,CAACC,SAAS,GAAG,CAAC;IAClB,IAAI,CAACC,QAAQ,GAAG,KAAK;IACrB,IAAI,CAACC,MAAM,GAAGH,MAAM,CAACI,SAAS,CAAC,CAAC;EACpC;EACA;AACJ;AACA;AACA;AACA;AACA;EACIC,KAAKA,CAAA,EAAG;IACJ;IACA;IACA,IAAI,IAAI,CAACH,QAAQ,EAAE;MACf,IAAI,CAACI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;MACjB;IACJ;IACA,IAAI,CAACC,WAAW,GAAG,IAAI,CAACJ,MAAM,CACzBK,IAAI,CAAC,CAAC,CACNC,IAAI,CAAEC,IAAI,IAAK;MAChB,OAAO,IAAI,CAACH,WAAW;MACvB,IAAIG,IAAI,CAACC,IAAI,IAAI,IAAI,CAACT,QAAQ,EAAE;QAC5B,IAAI,CAACI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;MACrB,CAAC,MACI;QACD,IAAI,CAACL,SAAS,IAAIS,IAAI,CAAChB,KAAK,CAACkB,MAAM;QACnC,IAAI,CAACN,IAAI,CAACI,IAAI,CAAChB,KAAK,CAAC,CAAC,CAAC;MAC3B;IACJ,CAAC,CAAC,CACGmB,KAAK,CAAEC,GAAG,IAAK;MAChB,IAAI,CAACC,OAAO,CAACD,GAAG,CAAC;IACrB,CAAC,CAAC;EACN;EACA;AACJ;AACA;AACA;EACI,MAAME,qBAAqBA,CAAA,EAAG;IAC1B,IAAI,IAAI,CAACT,WAAW,EAAE;MAClB,MAAM,IAAI,CAACA,WAAW;IAC1B;EACJ;EACA;AACJ;AACA;EACI,MAAMU,KAAKA,CAAA,EAAG;IACV,MAAM,IAAI,CAACC,cAAc,CAAC,CAAC;EAC/B;EACA,MAAMA,cAAcA,CAAA,EAAG;IACnB,IAAI,CAAChB,QAAQ,GAAG,IAAI;IACpB,MAAM,IAAI,CAACc,qBAAqB,CAAC,CAAC;IAClC,MAAM,IAAI,CAACb,MAAM,CAACgB,WAAW,CAAC,CAAC;EACnC;AACJ;AACA1B,OAAO,CAACE,uBAAuB,GAAGA,uBAAuB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}