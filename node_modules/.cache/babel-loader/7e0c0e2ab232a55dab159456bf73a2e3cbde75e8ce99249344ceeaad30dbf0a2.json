{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AbstractID3Parser = void 0;\nconst core_1 = require(\"strtok3/lib/core\");\nconst debug_1 = require(\"debug\");\nconst ID3v2Token_1 = require(\"./ID3v2Token\");\nconst ID3v2Parser_1 = require(\"./ID3v2Parser\");\nconst ID3v1Parser_1 = require(\"../id3v1/ID3v1Parser\");\nconst BasicParser_1 = require(\"../common/BasicParser\");\nconst debug = (0, debug_1.default)('music-metadata:parser:ID3');\n/**\n * Abstract parser which tries take ID3v2 and ID3v1 headers.\n */\nclass AbstractID3Parser extends BasicParser_1.BasicParser {\n  constructor() {\n    super(...arguments);\n    this.id3parser = new ID3v2Parser_1.ID3v2Parser();\n  }\n  static async startsWithID3v2Header(tokenizer) {\n    return (await tokenizer.peekToken(ID3v2Token_1.ID3v2Header)).fileIdentifier === 'ID3';\n  }\n  async parse() {\n    try {\n      await this.parseID3v2();\n    } catch (err) {\n      if (err instanceof core_1.EndOfStreamError) {\n        debug(`End-of-stream`);\n      } else {\n        throw err;\n      }\n    }\n  }\n  finalize() {\n    return;\n  }\n  async parseID3v2() {\n    await this.tryReadId3v2Headers();\n    debug('End of ID3v2 header, go to MPEG-parser: pos=%s', this.tokenizer.position);\n    await this.postId3v2Parse();\n    if (this.options.skipPostHeaders && this.metadata.hasAny()) {\n      this.finalize();\n    } else {\n      const id3v1parser = new ID3v1Parser_1.ID3v1Parser();\n      await id3v1parser.init(this.metadata, this.tokenizer, this.options).parse();\n      this.finalize();\n    }\n  }\n  async tryReadId3v2Headers() {\n    const id3Header = await this.tokenizer.peekToken(ID3v2Token_1.ID3v2Header);\n    if (id3Header.fileIdentifier === 'ID3') {\n      debug('Found ID3v2 header, pos=%s', this.tokenizer.position);\n      await this.id3parser.parse(this.metadata, this.tokenizer, this.options);\n      return this.tryReadId3v2Headers();\n    }\n  }\n}\nexports.AbstractID3Parser = AbstractID3Parser;","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}