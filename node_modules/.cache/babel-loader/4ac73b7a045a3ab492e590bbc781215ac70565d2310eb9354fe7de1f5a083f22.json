{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Trash2,Music}from'lucide-react';import{getLibrary,deleteFile}from'../../utils/idbFileStore';import Button from'../ui/button';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Library(_ref){let{onSelectFile,onLoadingChange}=_ref;const[libraryItems,setLibraryItems]=useState([]);const[loading,setLoading]=useState(true);useEffect(()=>{loadLibrary();},[]);const loadLibrary=async()=>{try{const items=await getLibrary();setLibraryItems(items);}catch(err){console.error('Failed to load library:',err);}finally{setLoading(false);}};const handleDelete=async(fileId,e)=>{e.stopPropagation();if(!window.confirm('Delete this file from library?'))return;try{await deleteFile(fileId);setLibraryItems(prev=>prev.filter(item=>item.fileId!==fileId));}catch(err){console.error('Failed to delete file:',err);}};const handleSelectFile=async fileId=>{onLoadingChange===null||onLoadingChange===void 0?void 0:onLoadingChange(true);try{const entry=await getLibrary().then(items=>items.find(i=>i.fileId===fileId));onSelectFile(fileId,entry);}finally{onLoadingChange===null||onLoadingChange===void 0?void 0:onLoadingChange(false);}};const formatDate=dateStr=>{const date=new Date(dateStr);const now=new Date();const diffMs=now-date;const diffMins=Math.floor(diffMs/60000);const diffHours=Math.floor(diffMins/60);const diffDays=Math.floor(diffHours/24);if(diffMins<1)return'just now';if(diffMins<60)return\"\".concat(diffMins,\"m ago\");if(diffHours<24)return\"\".concat(diffHours,\"h ago\");if(diffDays<7)return\"\".concat(diffDays,\"d ago\");return date.toLocaleDateString();};const formatDuration=seconds=>{if(!seconds)return'0:00';const hrs=Math.floor(seconds/3600);const mins=Math.floor(seconds%3600/60);const secs=Math.floor(seconds%60);if(hrs>0)return\"\".concat(hrs,\":\").concat(mins.toString().padStart(2,'0'),\":\").concat(secs.toString().padStart(2,'0'));return\"\".concat(mins,\":\").concat(secs.toString().padStart(2,'0'));};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64 text-gray-400\",children:\"Loading library...\"});}if(libraryItems.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center h-64 text-gray-400\",children:[/*#__PURE__*/_jsx(Music,{className:\"w-12 h-12 mb-4 opacity-50\"}),/*#__PURE__*/_jsx(\"p\",{children:\"No audiobooks in library yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm mt-2\",children:\"Upload an audiobook to get started\"})]});}return/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:libraryItems.map(item=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>handleSelectFile(item.fileId),className:\"flex gap-4 p-4 bg-gray-800 hover:bg-gray-700 rounded-lg cursor-pointer transition-colors group\",children:[item.cover?/*#__PURE__*/_jsx(\"img\",{src:item.cover,alt:item.title,className:\"w-16 h-16 object-cover rounded flex-shrink-0\"}):/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 bg-gradient-to-br from-purple-600 to-blue-600 rounded flex items-center justify-center flex-shrink-0\",children:/*#__PURE__*/_jsx(Music,{className:\"w-8 h-8 text-white opacity-60\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-white truncate\",children:item.title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-400 truncate\",children:item.artist}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 mt-2 text-xs text-gray-500\",children:[/*#__PURE__*/_jsx(\"span\",{children:formatDuration(item.duration)}),item.lastPlayed&&/*#__PURE__*/_jsx(\"span\",{children:formatDate(item.lastPlayed)}),item.playbackPosition>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-yellow-400\",children:[formatDuration(item.playbackPosition),\" played\"]})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>handleDelete(item.fileId,e),className:\"flex-shrink-0 p-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity\",title:\"Delete from library\",children:/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4\"})})]},item.fileId))});}","map":{"version":3,"names":["React","useState","useEffect","Trash2","Music","getLibrary","deleteFile","Button","jsx","_jsx","jsxs","_jsxs","Library","_ref","onSelectFile","onLoadingChange","libraryItems","setLibraryItems","loading","setLoading","loadLibrary","items","err","console","error","handleDelete","fileId","e","stopPropagation","window","confirm","prev","filter","item","handleSelectFile","entry","then","find","i","formatDate","dateStr","date","Date","now","diffMs","diffMins","Math","floor","diffHours","diffDays","concat","toLocaleDateString","formatDuration","seconds","hrs","mins","secs","toString","padStart","className","children","length","map","onClick","cover","src","alt","title","artist","duration","lastPlayed","playbackPosition"],"sources":["C:/Users/gabby/Documents/Audiobook Listener/src/Components/audiobook/Library.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Trash2, Music } from 'lucide-react';\r\nimport { getLibrary, deleteFile } from '../../utils/idbFileStore';\r\nimport Button from '../ui/button';\r\n\r\nexport default function Library({ onSelectFile, onLoadingChange }) {\r\n  const [libraryItems, setLibraryItems] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadLibrary();\r\n  }, []);\r\n\r\n  const loadLibrary = async () => {\r\n    try {\r\n      const items = await getLibrary();\r\n      setLibraryItems(items);\r\n    } catch (err) {\r\n      console.error('Failed to load library:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (fileId, e) => {\r\n    e.stopPropagation();\r\n    if (!window.confirm('Delete this file from library?')) return;\r\n    \r\n    try {\r\n      await deleteFile(fileId);\r\n      setLibraryItems(prev => prev.filter(item => item.fileId !== fileId));\r\n    } catch (err) {\r\n      console.error('Failed to delete file:', err);\r\n    }\r\n  };\r\n\r\n  const handleSelectFile = async (fileId) => {\r\n    onLoadingChange?.(true);\r\n    try {\r\n      const entry = await getLibrary().then(items => items.find(i => i.fileId === fileId));\r\n      onSelectFile(fileId, entry);\r\n    } finally {\r\n      onLoadingChange?.(false);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateStr) => {\r\n    const date = new Date(dateStr);\r\n    const now = new Date();\r\n    const diffMs = now - date;\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMins / 60);\r\n    const diffDays = Math.floor(diffHours / 24);\r\n\r\n    if (diffMins < 1) return 'just now';\r\n    if (diffMins < 60) return `${diffMins}m ago`;\r\n    if (diffHours < 24) return `${diffHours}h ago`;\r\n    if (diffDays < 7) return `${diffDays}d ago`;\r\n    return date.toLocaleDateString();\r\n  };\r\n\r\n  const formatDuration = (seconds) => {\r\n    if (!seconds) return '0:00';\r\n    const hrs = Math.floor(seconds / 3600);\r\n    const mins = Math.floor((seconds % 3600) / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    if (hrs > 0) return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"flex items-center justify-center h-64 text-gray-400\">Loading library...</div>;\r\n  }\r\n\r\n  if (libraryItems.length === 0) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center h-64 text-gray-400\">\r\n        <Music className=\"w-12 h-12 mb-4 opacity-50\" />\r\n        <p>No audiobooks in library yet</p>\r\n        <p className=\"text-sm mt-2\">Upload an audiobook to get started</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      {libraryItems.map((item) => (\r\n        <div\r\n          key={item.fileId}\r\n          onClick={() => handleSelectFile(item.fileId)}\r\n          className=\"flex gap-4 p-4 bg-gray-800 hover:bg-gray-700 rounded-lg cursor-pointer transition-colors group\"\r\n        >\r\n          {item.cover ? (\r\n            <img\r\n              src={item.cover}\r\n              alt={item.title}\r\n              className=\"w-16 h-16 object-cover rounded flex-shrink-0\"\r\n            />\r\n          ) : (\r\n            <div className=\"w-16 h-16 bg-gradient-to-br from-purple-600 to-blue-600 rounded flex items-center justify-center flex-shrink-0\">\r\n              <Music className=\"w-8 h-8 text-white opacity-60\" />\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex-1 min-w-0\">\r\n            <h3 className=\"font-semibold text-white truncate\">{item.title}</h3>\r\n            <p className=\"text-sm text-gray-400 truncate\">{item.artist}</p>\r\n            <div className=\"flex gap-3 mt-2 text-xs text-gray-500\">\r\n              <span>{formatDuration(item.duration)}</span>\r\n              {item.lastPlayed && <span>{formatDate(item.lastPlayed)}</span>}\r\n              {item.playbackPosition > 0 && (\r\n                <span className=\"text-yellow-400\">\r\n                  {formatDuration(item.playbackPosition)} played\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <button\r\n            onClick={(e) => handleDelete(item.fileId, e)}\r\n            className=\"flex-shrink-0 p-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n            title=\"Delete from library\"\r\n          >\r\n            <Trash2 className=\"w-4 h-4\" />\r\n          </button>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}