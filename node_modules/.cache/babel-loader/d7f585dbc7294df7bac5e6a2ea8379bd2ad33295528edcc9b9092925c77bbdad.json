{"ast":null,"code":"import _objectSpread from\"C:/Users/gabby/Documents/Audiobook Listener/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// IndexedDB file store with library support\nexport function openDB(){let dbName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'audiobook-store';return new Promise((resolve,reject)=>{const req=indexedDB.open(dbName,2);req.onupgradeneeded=e=>{const db=e.target.result;// files store: keyed by fileId, contains {blob, metadata}\nif(!db.objectStoreNames.contains('files')){db.createObjectStore('files');}// library store: keyed by fileId, contains {fileId, title, artist, cover, duration, addedDate, lastPlayed, playbackPosition}\nif(!db.objectStoreNames.contains('library')){db.createObjectStore('library');}};req.onsuccess=()=>resolve(req.result);req.onerror=()=>reject(req.error);});}// Save file blob with auto-generated ID\nexport async function saveFile(fileBlob){let metadata=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const fileId=Date.now().toString();const db=await openDB();return new Promise((resolve,reject)=>{const tx=db.transaction(['files','library'],'readwrite');// Save file blob\nconst filesStore=tx.objectStore('files');filesStore.put(fileBlob,fileId);// Save library entry with metadata\nconst libraryStore=tx.objectStore('library');const libraryEntry={fileId,title:metadata.title||'Unknown Title',artist:metadata.artist||'Unknown Artist',cover:metadata.cover||null,duration:metadata.duration||0,chapters:metadata.chapters||[],addedDate:new Date().toISOString(),lastPlayed:null,playbackPosition:0};libraryStore.put(libraryEntry,fileId);tx.oncomplete=()=>resolve(fileId);tx.onerror=()=>reject(tx.error);});}// Get file blob by ID\nexport async function getFile(fileId){const db=await openDB();return new Promise((resolve,reject)=>{const tx=db.transaction('files','readonly');const store=tx.objectStore('files');const req=store.get(fileId);req.onsuccess=()=>resolve(req.result||null);req.onerror=()=>reject(req.error);});}// Get library entry by ID\nexport async function getLibraryEntry(fileId){const db=await openDB();return new Promise((resolve,reject)=>{const tx=db.transaction('library','readonly');const store=tx.objectStore('library');const req=store.get(fileId);req.onsuccess=()=>resolve(req.result||null);req.onerror=()=>reject(req.error);});}// Get all library entries (the file library)\nexport async function getLibrary(){const db=await openDB();return new Promise((resolve,reject)=>{const tx=db.transaction('library','readonly');const store=tx.objectStore('library');const req=store.getAll();req.onsuccess=()=>{const entries=req.result;// Sort by lastPlayed (most recent first), then by addedDate\nentries.sort((a,b)=>{if(a.lastPlayed&&b.lastPlayed){return new Date(b.lastPlayed)-new Date(a.lastPlayed);}if(a.lastPlayed)return-1;if(b.lastPlayed)return 1;return new Date(b.addedDate)-new Date(a.addedDate);});resolve(entries);};req.onerror=()=>reject(req.error);});}// Update library entry (e.g., playback position, lastPlayed)\nexport async function updateLibraryEntry(fileId,updates){const db=await openDB();return new Promise((resolve,reject)=>{const tx=db.transaction('library','readwrite');const store=tx.objectStore('library');const getReq=store.get(fileId);getReq.onsuccess=()=>{const entry=getReq.result;if(entry){const updated=_objectSpread(_objectSpread(_objectSpread({},entry),updates),{},{lastPlayed:new Date().toISOString()});const putReq=store.put(updated,fileId);putReq.onsuccess=()=>resolve(updated);putReq.onerror=()=>reject(putReq.error);}else{reject(new Error('Library entry not found'));}};getReq.onerror=()=>reject(getReq.error);});}// Delete file and library entry\nexport async function deleteFile(fileId){const db=await openDB();return new Promise((resolve,reject)=>{const tx=db.transaction(['files','library'],'readwrite');tx.objectStore('files').delete(fileId);tx.objectStore('library').delete(fileId);tx.oncomplete=()=>resolve(true);tx.onerror=()=>reject(tx.error);});}","map":{"version":3,"names":["openDB","dbName","arguments","length","undefined","Promise","resolve","reject","req","indexedDB","open","onupgradeneeded","e","db","target","result","objectStoreNames","contains","createObjectStore","onsuccess","onerror","error","saveFile","fileBlob","metadata","fileId","Date","now","toString","tx","transaction","filesStore","objectStore","put","libraryStore","libraryEntry","title","artist","cover","duration","chapters","addedDate","toISOString","lastPlayed","playbackPosition","oncomplete","getFile","store","get","getLibraryEntry","getLibrary","getAll","entries","sort","a","b","updateLibraryEntry","updates","getReq","entry","updated","_objectSpread","putReq","Error","deleteFile","delete"],"sources":["C:/Users/gabby/Documents/Audiobook Listener/src/utils/idbFileStore.js"],"sourcesContent":["// IndexedDB file store with library support\r\nexport function openDB(dbName = 'audiobook-store') {\r\n  return new Promise((resolve, reject) => {\r\n    const req = indexedDB.open(dbName, 2);\r\n    req.onupgradeneeded = (e) => {\r\n      const db = e.target.result;\r\n      // files store: keyed by fileId, contains {blob, metadata}\r\n      if (!db.objectStoreNames.contains('files')) {\r\n        db.createObjectStore('files');\r\n      }\r\n      // library store: keyed by fileId, contains {fileId, title, artist, cover, duration, addedDate, lastPlayed, playbackPosition}\r\n      if (!db.objectStoreNames.contains('library')) {\r\n        db.createObjectStore('library');\r\n      }\r\n    };\r\n    req.onsuccess = () => resolve(req.result);\r\n    req.onerror = () => reject(req.error);\r\n  });\r\n}\r\n\r\n// Save file blob with auto-generated ID\r\nexport async function saveFile(fileBlob, metadata = {}) {\r\n  const fileId = Date.now().toString();\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction(['files', 'library'], 'readwrite');\r\n    \r\n    // Save file blob\r\n    const filesStore = tx.objectStore('files');\r\n    filesStore.put(fileBlob, fileId);\r\n    \r\n    // Save library entry with metadata\r\n    const libraryStore = tx.objectStore('library');\r\n    const libraryEntry = {\r\n      fileId,\r\n      title: metadata.title || 'Unknown Title',\r\n      artist: metadata.artist || 'Unknown Artist',\r\n      cover: metadata.cover || null,\r\n      duration: metadata.duration || 0,\r\n      chapters: metadata.chapters || [],\r\n      addedDate: new Date().toISOString(),\r\n      lastPlayed: null,\r\n      playbackPosition: 0,\r\n    };\r\n    libraryStore.put(libraryEntry, fileId);\r\n    \r\n    tx.oncomplete = () => resolve(fileId);\r\n    tx.onerror = () => reject(tx.error);\r\n  });\r\n}\r\n\r\n// Get file blob by ID\r\nexport async function getFile(fileId) {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction('files', 'readonly');\r\n    const store = tx.objectStore('files');\r\n    const req = store.get(fileId);\r\n    req.onsuccess = () => resolve(req.result || null);\r\n    req.onerror = () => reject(req.error);\r\n  });\r\n}\r\n\r\n// Get library entry by ID\r\nexport async function getLibraryEntry(fileId) {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction('library', 'readonly');\r\n    const store = tx.objectStore('library');\r\n    const req = store.get(fileId);\r\n    req.onsuccess = () => resolve(req.result || null);\r\n    req.onerror = () => reject(req.error);\r\n  });\r\n}\r\n\r\n// Get all library entries (the file library)\r\nexport async function getLibrary() {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction('library', 'readonly');\r\n    const store = tx.objectStore('library');\r\n    const req = store.getAll();\r\n    req.onsuccess = () => {\r\n      const entries = req.result;\r\n      // Sort by lastPlayed (most recent first), then by addedDate\r\n      entries.sort((a, b) => {\r\n        if (a.lastPlayed && b.lastPlayed) {\r\n          return new Date(b.lastPlayed) - new Date(a.lastPlayed);\r\n        }\r\n        if (a.lastPlayed) return -1;\r\n        if (b.lastPlayed) return 1;\r\n        return new Date(b.addedDate) - new Date(a.addedDate);\r\n      });\r\n      resolve(entries);\r\n    };\r\n    req.onerror = () => reject(req.error);\r\n  });\r\n}\r\n\r\n// Update library entry (e.g., playback position, lastPlayed)\r\nexport async function updateLibraryEntry(fileId, updates) {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction('library', 'readwrite');\r\n    const store = tx.objectStore('library');\r\n    \r\n    const getReq = store.get(fileId);\r\n    getReq.onsuccess = () => {\r\n      const entry = getReq.result;\r\n      if (entry) {\r\n        const updated = { ...entry, ...updates, lastPlayed: new Date().toISOString() };\r\n        const putReq = store.put(updated, fileId);\r\n        putReq.onsuccess = () => resolve(updated);\r\n        putReq.onerror = () => reject(putReq.error);\r\n      } else {\r\n        reject(new Error('Library entry not found'));\r\n      }\r\n    };\r\n    getReq.onerror = () => reject(getReq.error);\r\n  });\r\n}\r\n\r\n// Delete file and library entry\r\nexport async function deleteFile(fileId) {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction(['files', 'library'], 'readwrite');\r\n    \r\n    tx.objectStore('files').delete(fileId);\r\n    tx.objectStore('library').delete(fileId);\r\n    \r\n    tx.oncomplete = () => resolve(true);\r\n    tx.onerror = () => reject(tx.error);\r\n  });\r\n}\r\n"],"mappings":"gIAAA;AACA,MAAO,SAAS,CAAAA,MAAMA,CAAA,CAA6B,IAA5B,CAAAC,MAAM,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,iBAAiB,CAC/C,MAAO,IAAI,CAAAG,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACtC,KAAM,CAAAC,GAAG,CAAGC,SAAS,CAACC,IAAI,CAACT,MAAM,CAAE,CAAC,CAAC,CACrCO,GAAG,CAACG,eAAe,CAAIC,CAAC,EAAK,CAC3B,KAAM,CAAAC,EAAE,CAAGD,CAAC,CAACE,MAAM,CAACC,MAAM,CAC1B;AACA,GAAI,CAACF,EAAE,CAACG,gBAAgB,CAACC,QAAQ,CAAC,OAAO,CAAC,CAAE,CAC1CJ,EAAE,CAACK,iBAAiB,CAAC,OAAO,CAAC,CAC/B,CACA;AACA,GAAI,CAACL,EAAE,CAACG,gBAAgB,CAACC,QAAQ,CAAC,SAAS,CAAC,CAAE,CAC5CJ,EAAE,CAACK,iBAAiB,CAAC,SAAS,CAAC,CACjC,CACF,CAAC,CACDV,GAAG,CAACW,SAAS,CAAG,IAAMb,OAAO,CAACE,GAAG,CAACO,MAAM,CAAC,CACzCP,GAAG,CAACY,OAAO,CAAG,IAAMb,MAAM,CAACC,GAAG,CAACa,KAAK,CAAC,CACvC,CAAC,CAAC,CACJ,CAEA;AACA,MAAO,eAAe,CAAAC,QAAQA,CAACC,QAAQ,CAAiB,IAAf,CAAAC,QAAQ,CAAAtB,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,CAAC,CAAC,CACpD,KAAM,CAAAuB,MAAM,CAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CACpC,KAAM,CAAAf,EAAE,CAAG,KAAM,CAAAb,MAAM,CAAC,CAAC,CACzB,MAAO,IAAI,CAAAK,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACtC,KAAM,CAAAsB,EAAE,CAAGhB,EAAE,CAACiB,WAAW,CAAC,CAAC,OAAO,CAAE,SAAS,CAAC,CAAE,WAAW,CAAC,CAE5D;AACA,KAAM,CAAAC,UAAU,CAAGF,EAAE,CAACG,WAAW,CAAC,OAAO,CAAC,CAC1CD,UAAU,CAACE,GAAG,CAACV,QAAQ,CAAEE,MAAM,CAAC,CAEhC;AACA,KAAM,CAAAS,YAAY,CAAGL,EAAE,CAACG,WAAW,CAAC,SAAS,CAAC,CAC9C,KAAM,CAAAG,YAAY,CAAG,CACnBV,MAAM,CACNW,KAAK,CAAEZ,QAAQ,CAACY,KAAK,EAAI,eAAe,CACxCC,MAAM,CAAEb,QAAQ,CAACa,MAAM,EAAI,gBAAgB,CAC3CC,KAAK,CAAEd,QAAQ,CAACc,KAAK,EAAI,IAAI,CAC7BC,QAAQ,CAAEf,QAAQ,CAACe,QAAQ,EAAI,CAAC,CAChCC,QAAQ,CAAEhB,QAAQ,CAACgB,QAAQ,EAAI,EAAE,CACjCC,SAAS,CAAE,GAAI,CAAAf,IAAI,CAAC,CAAC,CAACgB,WAAW,CAAC,CAAC,CACnCC,UAAU,CAAE,IAAI,CAChBC,gBAAgB,CAAE,CACpB,CAAC,CACDV,YAAY,CAACD,GAAG,CAACE,YAAY,CAAEV,MAAM,CAAC,CAEtCI,EAAE,CAACgB,UAAU,CAAG,IAAMvC,OAAO,CAACmB,MAAM,CAAC,CACrCI,EAAE,CAACT,OAAO,CAAG,IAAMb,MAAM,CAACsB,EAAE,CAACR,KAAK,CAAC,CACrC,CAAC,CAAC,CACJ,CAEA;AACA,MAAO,eAAe,CAAAyB,OAAOA,CAACrB,MAAM,CAAE,CACpC,KAAM,CAAAZ,EAAE,CAAG,KAAM,CAAAb,MAAM,CAAC,CAAC,CACzB,MAAO,IAAI,CAAAK,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACtC,KAAM,CAAAsB,EAAE,CAAGhB,EAAE,CAACiB,WAAW,CAAC,OAAO,CAAE,UAAU,CAAC,CAC9C,KAAM,CAAAiB,KAAK,CAAGlB,EAAE,CAACG,WAAW,CAAC,OAAO,CAAC,CACrC,KAAM,CAAAxB,GAAG,CAAGuC,KAAK,CAACC,GAAG,CAACvB,MAAM,CAAC,CAC7BjB,GAAG,CAACW,SAAS,CAAG,IAAMb,OAAO,CAACE,GAAG,CAACO,MAAM,EAAI,IAAI,CAAC,CACjDP,GAAG,CAACY,OAAO,CAAG,IAAMb,MAAM,CAACC,GAAG,CAACa,KAAK,CAAC,CACvC,CAAC,CAAC,CACJ,CAEA;AACA,MAAO,eAAe,CAAA4B,eAAeA,CAACxB,MAAM,CAAE,CAC5C,KAAM,CAAAZ,EAAE,CAAG,KAAM,CAAAb,MAAM,CAAC,CAAC,CACzB,MAAO,IAAI,CAAAK,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACtC,KAAM,CAAAsB,EAAE,CAAGhB,EAAE,CAACiB,WAAW,CAAC,SAAS,CAAE,UAAU,CAAC,CAChD,KAAM,CAAAiB,KAAK,CAAGlB,EAAE,CAACG,WAAW,CAAC,SAAS,CAAC,CACvC,KAAM,CAAAxB,GAAG,CAAGuC,KAAK,CAACC,GAAG,CAACvB,MAAM,CAAC,CAC7BjB,GAAG,CAACW,SAAS,CAAG,IAAMb,OAAO,CAACE,GAAG,CAACO,MAAM,EAAI,IAAI,CAAC,CACjDP,GAAG,CAACY,OAAO,CAAG,IAAMb,MAAM,CAACC,GAAG,CAACa,KAAK,CAAC,CACvC,CAAC,CAAC,CACJ,CAEA;AACA,MAAO,eAAe,CAAA6B,UAAUA,CAAA,CAAG,CACjC,KAAM,CAAArC,EAAE,CAAG,KAAM,CAAAb,MAAM,CAAC,CAAC,CACzB,MAAO,IAAI,CAAAK,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACtC,KAAM,CAAAsB,EAAE,CAAGhB,EAAE,CAACiB,WAAW,CAAC,SAAS,CAAE,UAAU,CAAC,CAChD,KAAM,CAAAiB,KAAK,CAAGlB,EAAE,CAACG,WAAW,CAAC,SAAS,CAAC,CACvC,KAAM,CAAAxB,GAAG,CAAGuC,KAAK,CAACI,MAAM,CAAC,CAAC,CAC1B3C,GAAG,CAACW,SAAS,CAAG,IAAM,CACpB,KAAM,CAAAiC,OAAO,CAAG5C,GAAG,CAACO,MAAM,CAC1B;AACAqC,OAAO,CAACC,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,CACrB,GAAID,CAAC,CAACX,UAAU,EAAIY,CAAC,CAACZ,UAAU,CAAE,CAChC,MAAO,IAAI,CAAAjB,IAAI,CAAC6B,CAAC,CAACZ,UAAU,CAAC,CAAG,GAAI,CAAAjB,IAAI,CAAC4B,CAAC,CAACX,UAAU,CAAC,CACxD,CACA,GAAIW,CAAC,CAACX,UAAU,CAAE,MAAO,CAAC,CAAC,CAC3B,GAAIY,CAAC,CAACZ,UAAU,CAAE,MAAO,EAAC,CAC1B,MAAO,IAAI,CAAAjB,IAAI,CAAC6B,CAAC,CAACd,SAAS,CAAC,CAAG,GAAI,CAAAf,IAAI,CAAC4B,CAAC,CAACb,SAAS,CAAC,CACtD,CAAC,CAAC,CACFnC,OAAO,CAAC8C,OAAO,CAAC,CAClB,CAAC,CACD5C,GAAG,CAACY,OAAO,CAAG,IAAMb,MAAM,CAACC,GAAG,CAACa,KAAK,CAAC,CACvC,CAAC,CAAC,CACJ,CAEA;AACA,MAAO,eAAe,CAAAmC,kBAAkBA,CAAC/B,MAAM,CAAEgC,OAAO,CAAE,CACxD,KAAM,CAAA5C,EAAE,CAAG,KAAM,CAAAb,MAAM,CAAC,CAAC,CACzB,MAAO,IAAI,CAAAK,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACtC,KAAM,CAAAsB,EAAE,CAAGhB,EAAE,CAACiB,WAAW,CAAC,SAAS,CAAE,WAAW,CAAC,CACjD,KAAM,CAAAiB,KAAK,CAAGlB,EAAE,CAACG,WAAW,CAAC,SAAS,CAAC,CAEvC,KAAM,CAAA0B,MAAM,CAAGX,KAAK,CAACC,GAAG,CAACvB,MAAM,CAAC,CAChCiC,MAAM,CAACvC,SAAS,CAAG,IAAM,CACvB,KAAM,CAAAwC,KAAK,CAAGD,MAAM,CAAC3C,MAAM,CAC3B,GAAI4C,KAAK,CAAE,CACT,KAAM,CAAAC,OAAO,CAAAC,aAAA,CAAAA,aAAA,CAAAA,aAAA,IAAQF,KAAK,EAAKF,OAAO,MAAEd,UAAU,CAAE,GAAI,CAAAjB,IAAI,CAAC,CAAC,CAACgB,WAAW,CAAC,CAAC,EAAE,CAC9E,KAAM,CAAAoB,MAAM,CAAGf,KAAK,CAACd,GAAG,CAAC2B,OAAO,CAAEnC,MAAM,CAAC,CACzCqC,MAAM,CAAC3C,SAAS,CAAG,IAAMb,OAAO,CAACsD,OAAO,CAAC,CACzCE,MAAM,CAAC1C,OAAO,CAAG,IAAMb,MAAM,CAACuD,MAAM,CAACzC,KAAK,CAAC,CAC7C,CAAC,IAAM,CACLd,MAAM,CAAC,GAAI,CAAAwD,KAAK,CAAC,yBAAyB,CAAC,CAAC,CAC9C,CACF,CAAC,CACDL,MAAM,CAACtC,OAAO,CAAG,IAAMb,MAAM,CAACmD,MAAM,CAACrC,KAAK,CAAC,CAC7C,CAAC,CAAC,CACJ,CAEA;AACA,MAAO,eAAe,CAAA2C,UAAUA,CAACvC,MAAM,CAAE,CACvC,KAAM,CAAAZ,EAAE,CAAG,KAAM,CAAAb,MAAM,CAAC,CAAC,CACzB,MAAO,IAAI,CAAAK,OAAO,CAAC,CAACC,OAAO,CAAEC,MAAM,GAAK,CACtC,KAAM,CAAAsB,EAAE,CAAGhB,EAAE,CAACiB,WAAW,CAAC,CAAC,OAAO,CAAE,SAAS,CAAC,CAAE,WAAW,CAAC,CAE5DD,EAAE,CAACG,WAAW,CAAC,OAAO,CAAC,CAACiC,MAAM,CAACxC,MAAM,CAAC,CACtCI,EAAE,CAACG,WAAW,CAAC,SAAS,CAAC,CAACiC,MAAM,CAACxC,MAAM,CAAC,CAExCI,EAAE,CAACgB,UAAU,CAAG,IAAMvC,OAAO,CAAC,IAAI,CAAC,CACnCuB,EAAE,CAACT,OAAO,CAAG,IAAMb,MAAM,CAACsB,EAAE,CAACR,KAAK,CAAC,CACrC,CAAC,CAAC,CACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}