{"ast":null,"code":"// IndexedDB file store with library support\nexport function openDB(dbName = 'audiobook-store') {\n  return new Promise((resolve, reject) => {\n    const req = indexedDB.open(dbName, 2);\n    req.onupgradeneeded = e => {\n      const db = e.target.result;\n      // files store: keyed by fileId, contains {blob, metadata}\n      if (!db.objectStoreNames.contains('files')) {\n        db.createObjectStore('files');\n      }\n      // library store: keyed by fileId, contains {fileId, title, artist, cover, duration, addedDate, lastPlayed, playbackPosition}\n      if (!db.objectStoreNames.contains('library')) {\n        db.createObjectStore('library');\n      }\n    };\n    req.onsuccess = () => resolve(req.result);\n    req.onerror = () => reject(req.error);\n  });\n}\n\n// Save file blob with auto-generated ID\nexport async function saveFile(fileBlob, metadata = {}) {\n  const fileId = Date.now().toString();\n  const db = await openDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction(['files', 'library'], 'readwrite');\n\n    // Save file blob\n    const filesStore = tx.objectStore('files');\n    filesStore.put(fileBlob, fileId);\n\n    // Save library entry with metadata\n    const libraryStore = tx.objectStore('library');\n    const libraryEntry = {\n      fileId,\n      title: metadata.title || 'Unknown Title',\n      artist: metadata.artist || 'Unknown Artist',\n      cover: metadata.cover || null,\n      duration: metadata.duration || 0,\n      chapters: metadata.chapters || [],\n      addedDate: new Date().toISOString(),\n      lastPlayed: null,\n      playbackPosition: 0\n    };\n    libraryStore.put(libraryEntry, fileId);\n    tx.oncomplete = () => resolve(fileId);\n    tx.onerror = () => reject(tx.error);\n  });\n}\n\n// Get file blob by ID\nexport async function getFile(fileId) {\n  const db = await openDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction('files', 'readonly');\n    const store = tx.objectStore('files');\n    const req = store.get(fileId);\n    req.onsuccess = () => resolve(req.result || null);\n    req.onerror = () => reject(req.error);\n  });\n}\n\n// Get library entry by ID\nexport async function getLibraryEntry(fileId) {\n  const db = await openDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction('library', 'readonly');\n    const store = tx.objectStore('library');\n    const req = store.get(fileId);\n    req.onsuccess = () => resolve(req.result || null);\n    req.onerror = () => reject(req.error);\n  });\n}\n\n// Get all library entries (the file library)\nexport async function getLibrary() {\n  const db = await openDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction('library', 'readonly');\n    const store = tx.objectStore('library');\n    const req = store.getAll();\n    req.onsuccess = () => {\n      const entries = req.result;\n      // Sort by lastPlayed (most recent first), then by addedDate\n      entries.sort((a, b) => {\n        if (a.lastPlayed && b.lastPlayed) {\n          return new Date(b.lastPlayed) - new Date(a.lastPlayed);\n        }\n        if (a.lastPlayed) return -1;\n        if (b.lastPlayed) return 1;\n        return new Date(b.addedDate) - new Date(a.addedDate);\n      });\n      resolve(entries);\n    };\n    req.onerror = () => reject(req.error);\n  });\n}\n\n// Update library entry (e.g., playback position, lastPlayed)\nexport async function updateLibraryEntry(fileId, updates) {\n  const db = await openDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction('library', 'readwrite');\n    const store = tx.objectStore('library');\n    const getReq = store.get(fileId);\n    getReq.onsuccess = () => {\n      const entry = getReq.result;\n      if (entry) {\n        const updated = {\n          ...entry,\n          ...updates,\n          lastPlayed: new Date().toISOString()\n        };\n        const putReq = store.put(updated, fileId);\n        putReq.onsuccess = () => resolve(updated);\n        putReq.onerror = () => reject(putReq.error);\n      } else {\n        reject(new Error('Library entry not found'));\n      }\n    };\n    getReq.onerror = () => reject(getReq.error);\n  });\n}\n\n// Delete file and library entry\nexport async function deleteFile(fileId) {\n  const db = await openDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction(['files', 'library'], 'readwrite');\n    tx.objectStore('files').delete(fileId);\n    tx.objectStore('library').delete(fileId);\n    tx.oncomplete = () => resolve(true);\n    tx.onerror = () => reject(tx.error);\n  });\n}","map":{"version":3,"names":["openDB","dbName","Promise","resolve","reject","req","indexedDB","open","onupgradeneeded","e","db","target","result","objectStoreNames","contains","createObjectStore","onsuccess","onerror","error","saveFile","fileBlob","metadata","fileId","Date","now","toString","tx","transaction","filesStore","objectStore","put","libraryStore","libraryEntry","title","artist","cover","duration","chapters","addedDate","toISOString","lastPlayed","playbackPosition","oncomplete","getFile","store","get","getLibraryEntry","getLibrary","getAll","entries","sort","a","b","updateLibraryEntry","updates","getReq","entry","updated","putReq","Error","deleteFile","delete"],"sources":["C:/Users/gabby/Documents/Audiobook Listener/src/utils/idbFileStore.js"],"sourcesContent":["// IndexedDB file store with library support\r\nexport function openDB(dbName = 'audiobook-store') {\r\n  return new Promise((resolve, reject) => {\r\n    const req = indexedDB.open(dbName, 2);\r\n    req.onupgradeneeded = (e) => {\r\n      const db = e.target.result;\r\n      // files store: keyed by fileId, contains {blob, metadata}\r\n      if (!db.objectStoreNames.contains('files')) {\r\n        db.createObjectStore('files');\r\n      }\r\n      // library store: keyed by fileId, contains {fileId, title, artist, cover, duration, addedDate, lastPlayed, playbackPosition}\r\n      if (!db.objectStoreNames.contains('library')) {\r\n        db.createObjectStore('library');\r\n      }\r\n    };\r\n    req.onsuccess = () => resolve(req.result);\r\n    req.onerror = () => reject(req.error);\r\n  });\r\n}\r\n\r\n// Save file blob with auto-generated ID\r\nexport async function saveFile(fileBlob, metadata = {}) {\r\n  const fileId = Date.now().toString();\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction(['files', 'library'], 'readwrite');\r\n    \r\n    // Save file blob\r\n    const filesStore = tx.objectStore('files');\r\n    filesStore.put(fileBlob, fileId);\r\n    \r\n    // Save library entry with metadata\r\n    const libraryStore = tx.objectStore('library');\r\n    const libraryEntry = {\r\n      fileId,\r\n      title: metadata.title || 'Unknown Title',\r\n      artist: metadata.artist || 'Unknown Artist',\r\n      cover: metadata.cover || null,\r\n      duration: metadata.duration || 0,\r\n      chapters: metadata.chapters || [],\r\n      addedDate: new Date().toISOString(),\r\n      lastPlayed: null,\r\n      playbackPosition: 0,\r\n    };\r\n    libraryStore.put(libraryEntry, fileId);\r\n    \r\n    tx.oncomplete = () => resolve(fileId);\r\n    tx.onerror = () => reject(tx.error);\r\n  });\r\n}\r\n\r\n// Get file blob by ID\r\nexport async function getFile(fileId) {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction('files', 'readonly');\r\n    const store = tx.objectStore('files');\r\n    const req = store.get(fileId);\r\n    req.onsuccess = () => resolve(req.result || null);\r\n    req.onerror = () => reject(req.error);\r\n  });\r\n}\r\n\r\n// Get library entry by ID\r\nexport async function getLibraryEntry(fileId) {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction('library', 'readonly');\r\n    const store = tx.objectStore('library');\r\n    const req = store.get(fileId);\r\n    req.onsuccess = () => resolve(req.result || null);\r\n    req.onerror = () => reject(req.error);\r\n  });\r\n}\r\n\r\n// Get all library entries (the file library)\r\nexport async function getLibrary() {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction('library', 'readonly');\r\n    const store = tx.objectStore('library');\r\n    const req = store.getAll();\r\n    req.onsuccess = () => {\r\n      const entries = req.result;\r\n      // Sort by lastPlayed (most recent first), then by addedDate\r\n      entries.sort((a, b) => {\r\n        if (a.lastPlayed && b.lastPlayed) {\r\n          return new Date(b.lastPlayed) - new Date(a.lastPlayed);\r\n        }\r\n        if (a.lastPlayed) return -1;\r\n        if (b.lastPlayed) return 1;\r\n        return new Date(b.addedDate) - new Date(a.addedDate);\r\n      });\r\n      resolve(entries);\r\n    };\r\n    req.onerror = () => reject(req.error);\r\n  });\r\n}\r\n\r\n// Update library entry (e.g., playback position, lastPlayed)\r\nexport async function updateLibraryEntry(fileId, updates) {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction('library', 'readwrite');\r\n    const store = tx.objectStore('library');\r\n    \r\n    const getReq = store.get(fileId);\r\n    getReq.onsuccess = () => {\r\n      const entry = getReq.result;\r\n      if (entry) {\r\n        const updated = { ...entry, ...updates, lastPlayed: new Date().toISOString() };\r\n        const putReq = store.put(updated, fileId);\r\n        putReq.onsuccess = () => resolve(updated);\r\n        putReq.onerror = () => reject(putReq.error);\r\n      } else {\r\n        reject(new Error('Library entry not found'));\r\n      }\r\n    };\r\n    getReq.onerror = () => reject(getReq.error);\r\n  });\r\n}\r\n\r\n// Delete file and library entry\r\nexport async function deleteFile(fileId) {\r\n  const db = await openDB();\r\n  return new Promise((resolve, reject) => {\r\n    const tx = db.transaction(['files', 'library'], 'readwrite');\r\n    \r\n    tx.objectStore('files').delete(fileId);\r\n    tx.objectStore('library').delete(fileId);\r\n    \r\n    tx.oncomplete = () => resolve(true);\r\n    tx.onerror = () => reject(tx.error);\r\n  });\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}