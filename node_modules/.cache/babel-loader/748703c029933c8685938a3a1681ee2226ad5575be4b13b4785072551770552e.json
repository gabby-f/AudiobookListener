{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.readXingHeader = exports.XingHeaderFlags = exports.LameEncoderVersion = exports.InfoTagHeaderTag = void 0;\nconst Token = require(\"token-types\");\nconst util = require(\"../common/Util\");\nconst ExtendedLameHeader_1 = require(\"./ExtendedLameHeader\");\n/**\n * Info Tag: Xing, LAME\n */\nexports.InfoTagHeaderTag = new Token.StringType(4, 'ascii');\n/**\n * LAME TAG value\n * Did not find any official documentation for this\n * Value e.g.: \"3.98.4\"\n */\nexports.LameEncoderVersion = new Token.StringType(6, 'ascii');\n/**\n * Info Tag\n * Ref: http://gabriel.mp3-tech.org/mp3infotag.html\n */\nexports.XingHeaderFlags = {\n  len: 4,\n  get: (buf, off) => {\n    return {\n      frames: util.isBitSet(buf, off, 31),\n      bytes: util.isBitSet(buf, off, 30),\n      toc: util.isBitSet(buf, off, 29),\n      vbrScale: util.isBitSet(buf, off, 28)\n    };\n  }\n};\n// /**\n//  * XING Header Tag\n//  * Ref: http://gabriel.mp3-tech.org/mp3infotag.html\n//  */\nasync function readXingHeader(tokenizer) {\n  const flags = await tokenizer.readToken(exports.XingHeaderFlags);\n  const xingInfoTag = {};\n  if (flags.frames) {\n    xingInfoTag.numFrames = await tokenizer.readToken(Token.UINT32_BE);\n  }\n  if (flags.bytes) {\n    xingInfoTag.streamSize = await tokenizer.readToken(Token.UINT32_BE);\n  }\n  if (flags.toc) {\n    xingInfoTag.toc = Buffer.alloc(100);\n    await tokenizer.readBuffer(xingInfoTag.toc);\n  }\n  if (flags.vbrScale) {\n    xingInfoTag.vbrScale = await tokenizer.readToken(Token.UINT32_BE);\n  }\n  const lameTag = await tokenizer.peekToken(new Token.StringType(4, 'ascii'));\n  if (lameTag === 'LAME') {\n    await tokenizer.ignore(4);\n    xingInfoTag.lame = {\n      version: await tokenizer.readToken(new Token.StringType(5, 'ascii'))\n    };\n    const match = xingInfoTag.lame.version.match(/\\d+.\\d+/g);\n    if (match) {\n      const majorMinorVersion = xingInfoTag.lame.version.match(/\\d+.\\d+/g)[0]; // e.g. 3.97\n      const version = majorMinorVersion.split('.').map(n => parseInt(n, 10));\n      if (version[0] >= 3 && version[1] >= 90) {\n        xingInfoTag.lame.extended = await tokenizer.readToken(ExtendedLameHeader_1.ExtendedLameHeader);\n      }\n    }\n  }\n  return xingInfoTag;\n}\nexports.readXingHeader = readXingHeader;","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}